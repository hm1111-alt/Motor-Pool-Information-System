<!DOCTYPE html>
<html>
<head>
    <title>Test Employee Data Population</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body>
    <div class="container mt-5">
        <h1>Test Employee Data Population</h1>
        
        <button type="button" class="btn btn-warning" onclick="testEmployeeData()">
            Test Employee Data Loading
        </button>
        
        <div id="test-results" class="mt-3"></div>
    </div>

    <!-- Edit Employee Modal -->
    <div class="modal fade" id="editEmployeeModal" tabindex="-1" aria-labelledby="editEmployeeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header" style="background-color:#1e6031; color:white;">
                    <h5 class="modal-title fw-bold" id="editEmployeeModalLabel">
                        Edit Employee
                    </h5>
                </div>
                
                <!-- Modal Body -->
                <form method="post" action="" id="editEmployeeForm">
                    <div class="modal-body px-4 py-3">
                        <!-- Loading indicator -->
                        <div id="editModalLoading" class="text-center py-4">
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading employee data...</p>
                        </div>
                        
                        <!-- Personal Information Section -->
                        <div id="editPersonalInfoSection" style="display: none;">
                            <h6 class="fw-bold text-success mb-3">Personal Information</h6>
                            <div class="row mb-3">
                                <div class="col-md-3">
                                    <label class="small fw-semibold text-success">First Name *</label>
                                    <input type="text" class="form-control form-control-sm border-success" name="first_name" id="edit_first_name" placeholder="Enter first name" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="small fw-semibold text-success">Middle Name</label>
                                    <input type="text" class="form-control form-control-sm border-success" name="middle_name" id="edit_middle_name" placeholder="Enter middle name" maxlength="255">
                                </div>
                                <div class="col-md-3">
                                    <label class="small fw-semibold text-success">Last Name *</label>
                                    <input type="text" class="form-control form-control-sm border-success" name="last_name" id="edit_last_name" placeholder="Enter last name" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="small fw-semibold text-success">Extension Name</label>
                                    <input type="text" class="form-control form-control-sm border-success" name="ext_name" id="edit_ext_name" placeholder="Enter extension name" maxlength="10">
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-3">
                                    <label class="small fw-semibold text-success">Sex *</label>
                                    <select class="form-control form-control-sm border-success" name="sex" id="edit_sex" required>
                                        <option value="">Select Sex</option>
                                        <option value="M">Male</option>
                                        <option value="F">Female</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="small fw-semibold text-success">Prefix</label>
                                    <input type="text" class="form-control form-control-sm border-success" name="prefix" id="edit_prefix" placeholder="Enter prefix" maxlength="10">
                                </div>
                                <div class="col-md-3">
                                    <label class="small fw-semibold text-success">Email *</label>
                                    <input type="email" class="form-control form-control-sm border-success" name="email" id="edit_email" placeholder="Enter email address" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="small fw-semibold text-success">Contact Number</label>
                                    <input type="tel" class="form-control form-control-sm border-success" name="contact_num" id="edit_contact_num" placeholder="Enter contact number">
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="small fw-semibold text-success">Status *</label>
                                    <select class="form-control form-control-sm border-success" name="emp_status" id="edit_emp_status" required>
                                        <option value="1">Active</option>
                                        <option value="0">Inactive</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Position Information Section -->
                        <div id="editPositionInfoSection" style="display: none;">
                            <h6 class="fw-bold text-success mb-3">Primary Position Information</h6>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="small fw-semibold text-success">Position Name *</label>
                                    <input type="text" class="form-control form-control-sm border-success" name="position_name" id="edit_position_name" placeholder="Enter position name" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="small fw-semibold text-success">Class</label>
                                    <select class="form-control form-control-sm border-success" name="class_id" id="edit_class_id">
                                        <option value="">Select Class (Optional)</option>
                                        <option value="1">STAFF</option>
                                        <option value="2">FACULTY</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="small fw-semibold text-success">Office</label>
                                    <select class="form-control form-control-sm border-success" name="office_id" id="edit_office_id">
                                        <option value="">Select Office (Optional)</option>
                                        <option value="1">Office of the University President</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="small fw-semibold text-success">Division</label>
                                    <select class="form-control form-control-sm border-success" name="division_id" id="edit_division_id">
                                        <option value="">Select Division (Optional)</option>
                                        <option value="1">Presidential Management Services</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="small fw-semibold text-success">Unit</label>
                                    <select class="form-control form-control-sm border-success" name="unit_id" id="edit_unit_id">
                                        <option value="">Select Unit (Optional)</option>
                                        <option value="1">Management Information System Office</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="small fw-semibold text-success">Subunit</label>
                                    <select class="form-control form-control-sm border-success" name="subunit_id" id="edit_subunit_id">
                                        <option value="">Select Subunit (Optional)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Modal Footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Update Employee</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function testEmployeeData() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>Testing employee data loading...</p>';
            
            // Test data matching what you showed
            const testData = {
                first_name: 'Knight',
                middle_name: 'Nasis',
                last_name: 'Black',
                ext_name: 'Jr.',
                sex: 'M',
                prefix: 'Dr.',
                user: {
                    email: 'knightinblack10221999@gmail.com'
                },
                contact_num: '09626143333',
                emp_status: 1,
                positions: [
                    {
                        is_primary: true,
                        position_name: 'Teacher',
                        class_id: 1,
                        office_id: 1,
                        division_id: 1,
                        unit_id: 1,
                        subunit_id: null
                    }
                ]
            };
            
            console.log('Test data:', testData);
            
            // Check if elements exist
            const formElements = [
                'edit_first_name', 'edit_middle_name', 'edit_last_name', 'edit_ext_name',
                'edit_sex', 'edit_prefix', 'edit_email', 'edit_contact_num', 'edit_emp_status',
                'edit_position_name', 'edit_class_id', 'edit_office_id', 'edit_division_id',
                'edit_unit_id', 'edit_subunit_id'
            ];
            
            let allFound = true;
            let missingElements = [];
            
            formElements.forEach(id => {
                const element = document.getElementById(id);
                if (!element) {
                    allFound = false;
                    missingElements.push(id);
                }
                console.log(`${id}: ${element ? 'Found' : 'Missing'}`);
            });
            
            if (!allFound) {
                resultsDiv.innerHTML = `<div class="alert alert-danger">Missing elements: ${missingElements.join(', ')}</div>`;
                return;
            }
            
            // Populate the form with test data
            try {
                document.getElementById('edit_first_name').value = testData.first_name || '';
                document.getElementById('edit_middle_name').value = testData.middle_name || '';
                document.getElementById('edit_last_name').value = testData.last_name || '';
                document.getElementById('edit_ext_name').value = testData.ext_name || '';
                document.getElementById('edit_sex').value = testData.sex || '';
                document.getElementById('edit_prefix').value = testData.prefix || '';
                document.getElementById('edit_email').value = testData.user?.email || '';
                document.getElementById('edit_contact_num').value = testData.contact_num || '';
                document.getElementById('edit_emp_status').value = testData.emp_status ? '1' : '0';
                
                // Populate primary position
                const primaryPosition = testData.positions?.find(p => p.is_primary) || {};
                document.getElementById('edit_position_name').value = primaryPosition.position_name || '';
                document.getElementById('edit_class_id').value = primaryPosition.class_id || '';
                
                // Show the sections
                document.getElementById('editModalLoading').style.display = 'none';
                document.getElementById('editPersonalInfoSection').style.display = 'block';
                document.getElementById('editPositionInfoSection').style.display = 'block';
                
                resultsDiv.innerHTML = '<div class="alert alert-success">Test data populated successfully! Check the modal.</div>';
                
                // Show the modal
                var myModal = new bootstrap.Modal(document.getElementById('editEmployeeModal'));
                myModal.show();
                
            } catch (error) {
                console.error('Error populating test data:', error);
                resultsDiv.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }
        
        // Test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Test page loaded');
            console.log('bootstrap available:', typeof bootstrap !== 'undefined');
        });
    </script>
</body>
</html>